params:
  version: string

imports:
  core: "https://github.com/opswalrus/core.git"
...

version = params.version

template = <<TEMPLATE
module OpsWalrus
  VERSION = "{{ version }}"
end
TEMPLATE

puts "Write version.rb for version #{version}"
core.template.write(path: "./lib/opswalrus/version.rb", template: template, variables: {version: version})

sh("Build gem") { 'gem build opswalrus.gemspec' }
sh("Build docker image") { 'docker build -t opswalrus/ops:{{ version }} .' }
